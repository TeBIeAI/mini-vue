{"version":3,"file":"mini-vue.esm-bundler.js","sources":["../../shared/src/index.ts","../../reactivity/src/effect.ts","../../reactivity/src/baseHandlers.ts","../../reactivity/src/reactive.ts"],"sourcesContent":["export const isObject = (val) => {\r\n    return val !== null && typeof val === 'object';\r\n};\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\r\nexport const hasOwn = (target, key) => {\r\n    return hasOwnProperty.call(target, key);\r\n};\r\n","const targetMap = new WeakMap();\r\nexport function track(target, type, key) {\r\n    let depsMap = targetMap.get(target);\r\n    if (!depsMap) {\r\n        targetMap.set(target, (depsMap = new Map()));\r\n    }\r\n    let dep = depsMap.get(key);\r\n    if (!dep) {\r\n        depsMap.set(key, (dep = new Map()));\r\n    }\r\n    trackEffects(dep);\r\n}\r\nexport function trackEffects(dep) { }\r\n","import { hasOwn, isObject } from '@vue/shared';\r\nimport { track } from './effect';\r\nimport { isReadonly, reactive, readonly } from './reactive';\r\nconst get = createGetter();\r\nconst readonlyGet = createGetter(true);\r\nconst set = createSetter();\r\nfunction createGetter(isReadOnly = false, shallow = false) {\r\n    return function get(target, key) {\r\n        const res = Reflect.get(target, key);\r\n        isReadonly(res);\r\n        if (!isReadOnly) {\r\n            // 此处可以开始收集依赖\r\n            track(target, 'add', key);\r\n        }\r\n        // 如果是浅层代理  直接返回  不必考虑key是否为对象\r\n        if (shallow) {\r\n            return res;\r\n        }\r\n        if (isObject(res)) {\r\n            // 此处需要处理只读属性 不需要做深层代理\r\n            // 如果访问的是一个对象  才开始对该属性进行代理，此处避免初始化的时候进行深层代理问题   访问时候才开始代理 进行依赖收集\r\n            return isReadOnly ? readonly(res) : reactive(res);\r\n        }\r\n        return res;\r\n    };\r\n}\r\nfunction createSetter(isReadOnly = false, shallow = false) {\r\n    return function set(target, key, value) {\r\n        let oldValue = target[key];\r\n        // 判断 oldValue 是否为只读属性 只读属性不能修改  reactive({name: {name1: {name2: 2}}})   name1 有可能被readonly 包裹\r\n        isReadonly(oldValue);\r\n        // 判断是新增 还是修改\r\n        const hadKey = hasOwn(target, key);\r\n        const result = Reflect.set(target, key, value);\r\n        if (!hadKey) {\r\n            // 新增\r\n        }\r\n        else {\r\n            // 修改\r\n        }\r\n        return result;\r\n    };\r\n}\r\nexport const mutableHandlers = {\r\n    get,\r\n    set\r\n};\r\nexport const readonlyHandlers = {\r\n    get: readonlyGet,\r\n    set(target, key) {\r\n        console.warn(`Set operation on key \"${String(key)}\" failed: target is readonly.`, target);\r\n        return true;\r\n    }\r\n};\r\n","import { isObject } from '@vue/shared';\r\nimport { mutableHandlers, readonlyHandlers } from './baseHandlers';\r\nexport const reactiveMap = new WeakMap();\r\nexport const shallowReactiveMap = new WeakMap();\r\nexport const readonlyMap = new WeakMap();\r\nexport const shallowReadonlyMap = new WeakMap();\r\nfunction createReactiveObject(target, isReadOnly, baseHandlers, proxyMap) {\r\n    if (!isObject(target)) {\r\n        console.warn(`value cannot be made reactive: ${String(target)}`);\r\n        return target;\r\n    }\r\n    const existingProxy = proxyMap.get(target);\r\n    if (existingProxy)\r\n        return target;\r\n    const proxy = new Proxy(target, baseHandlers);\r\n    proxyMap.set(target, proxy);\r\n    return proxy;\r\n}\r\nexport function reactive(target) {\r\n    // 先判断是否为isReadOnly\r\n    return createReactiveObject(target, false, mutableHandlers, reactiveMap);\r\n}\r\nexport function readonly(target) {\r\n    return createReactiveObject(target, true, readonlyHandlers, readonlyMap);\r\n}\r\nexport function isReadonly(value) {\r\n    return !!(value && value[\"__v_isReadonly\" /* ReactiveFlags.IS_READONLY */]);\r\n}\r\n"],"names":[],"mappings":"AAAO,MAAM,QAAQ,GAAG,CAAC,GAAG,KAAK;AACjC,IAAI,OAAO,GAAG,KAAK,IAAI,IAAI,OAAO,GAAG,KAAK,QAAQ,CAAC;AACnD,CAAC,CAAC;AACF,MAAM,cAAc,GAAG,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC;AAChD,MAAM,MAAM,GAAG,CAAC,MAAM,EAAE,GAAG,KAAK;AACvC,IAAI,OAAO,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;AAC5C,CAAC;;ACND,MAAM,SAAS,GAAG,IAAI,OAAO,EAAE,CAAC;AACzB,SAAS,KAAK,CAAC,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE;AACzC,IAAI,IAAI,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACxC,IAAI,IAAI,CAAC,OAAO,EAAE;AAClB,QAAQ,SAAS,CAAC,GAAG,CAAC,MAAM,GAAG,OAAO,GAAG,IAAI,GAAG,EAAE,EAAE,CAAC;AACrD,KAAK;AACL,IAAI,IAAI,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AAC/B,IAAI,IAAI,CAAC,GAAG,EAAE;AACd,QAAQ,OAAO,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,EAAE,EAAE,CAAC;AAC5C,KAAK;AAEL;;ACRA,MAAM,GAAG,GAAG,YAAY,EAAE,CAAC;AAC3B,MAAM,WAAW,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;AACvC,MAAM,GAAG,GAAG,YAAY,EAAE,CAAC;AAC3B,SAAS,YAAY,CAAC,UAAU,GAAG,KAAK,EAAE,OAAO,GAAG,KAAK,EAAE;AAC3D,IAAI,OAAO,SAAS,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE;AACrC,QAAQ,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;AAC7C,QAAQ,UAAU,CAAC,GAAG,CAAC,CAAC;AACxB,QAAQ,IAAI,CAAC,UAAU,EAAE;AACzB;AACA,YAAY,KAAK,CAAC,MAAM,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC;AACtC,SAAS;AACT;AACA,QAAQ,IAAI,OAAO,EAAE;AACrB,YAAY,OAAO,GAAG,CAAC;AACvB,SAAS;AACT,QAAQ,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;AAC3B;AACA;AACA,YAAY,OAAO,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC;AAC9D,SAAS;AACT,QAAQ,OAAO,GAAG,CAAC;AACnB,KAAK,CAAC;AACN,CAAC;AACD,SAAS,YAAY,CAAC,UAAU,GAAG,KAAK,EAAE,OAAO,GAAG,KAAK,EAAE;AAC3D,IAAI,OAAO,SAAS,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE;AAC5C,QAAQ,IAAI,QAAQ,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC;AACnC;AACA,QAAQ,UAAU,CAAC,QAAQ,CAAC,CAAC;AAC7B;AACA,QAAuB,MAAM,CAAC,MAAM,EAAE,GAAG,EAAE;AAC3C,QAAQ,MAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;AAOvD,QAAQ,OAAO,MAAM,CAAC;AACtB,KAAK,CAAC;AACN,CAAC;AACM,MAAM,eAAe,GAAG;AAC/B,IAAI,GAAG;AACP,IAAI,GAAG;AACP,CAAC,CAAC;AACK,MAAM,gBAAgB,GAAG;AAChC,IAAI,GAAG,EAAE,WAAW;AACpB,IAAI,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE;AACrB,QAAQ,OAAO,CAAC,IAAI,CAAC,CAAC,sBAAsB,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,6BAA6B,CAAC,EAAE,MAAM,CAAC,CAAC;AAClG,QAAQ,OAAO,IAAI,CAAC;AACpB,KAAK;AACL,CAAC;;ACnDM,MAAM,WAAW,GAAG,IAAI,OAAO,EAAE,CAAC;AAElC,MAAM,WAAW,GAAG,IAAI,OAAO,EAAE,CAAC;AAEzC,SAAS,oBAAoB,CAAC,MAAM,EAAE,UAAU,EAAE,YAAY,EAAE,QAAQ,EAAE;AAC1E,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;AAC3B,QAAQ,OAAO,CAAC,IAAI,CAAC,CAAC,+BAA+B,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;AACzE,QAAQ,OAAO,MAAM,CAAC;AACtB,KAAK;AACL,IAAI,MAAM,aAAa,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AAC/C,IAAI,IAAI,aAAa;AACrB,QAAQ,OAAO,MAAM,CAAC;AACtB,IAAI,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;AAClD,IAAI,QAAQ,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC;AAChC,IAAI,OAAO,KAAK,CAAC;AACjB,CAAC;AACM,SAAS,QAAQ,CAAC,MAAM,EAAE;AACjC;AACA,IAAI,OAAO,oBAAoB,CAAC,MAAM,EAAE,KAAK,EAAE,eAAe,EAAE,WAAW,CAAC,CAAC;AAC7E,CAAC;AACM,SAAS,QAAQ,CAAC,MAAM,EAAE;AACjC,IAAI,OAAO,oBAAoB,CAAC,MAAM,EAAE,IAAI,EAAE,gBAAgB,EAAE,WAAW,CAAC,CAAC;AAC7E,CAAC;AACM,SAAS,UAAU,CAAC,KAAK,EAAE;AAClC,IAAI,OAAO,CAAC,EAAE,KAAK,IAAI,KAAK,CAAC,gBAAgB,iCAAiC,CAAC,CAAC;AAChF;;;;"}