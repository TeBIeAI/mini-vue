{"version":3,"file":"mini-vue.esm-bundler.js","sources":["../../shared/src/index.ts","../../reactivity/src/effect.ts","../../reactivity/src/baseHandlers.ts","../../reactivity/src/reactive.ts","../../shared/index.ts","../../reactivity/src/ref.ts"],"sourcesContent":["export const isObject = (val) => {\r\n    return val !== null && typeof val === 'object';\r\n};\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\r\nexport const hasOwn = (target, key) => {\r\n    return hasOwnProperty.call(target, key);\r\n};\r\n","export let activeEffect;\r\nexport class ReactiveEffect {\r\n    constructor(fn, scheduler = null) {\r\n        this.fn = fn;\r\n        this.scheduler = scheduler;\r\n        this.active = true;\r\n        this.deps = [];\r\n    }\r\n    run() {\r\n        if (!this.active) {\r\n            return this.fn();\r\n        }\r\n        try {\r\n            activeEffect = this;\r\n            return this.fn();\r\n        }\r\n        finally {\r\n            activeEffect = undefined;\r\n        }\r\n    }\r\n    stop() {\r\n        // if(this.active) {\r\n        //   clear\r\n        // }\r\n    }\r\n}\r\nexport function effect(fn, options) {\r\n    const _effect = new ReactiveEffect(fn);\r\n    _effect.run();\r\n    const runner = _effect.run.bind(_effect);\r\n    runner.effect = _effect;\r\n    return runner;\r\n}\r\nconst targetMap = new WeakMap();\r\nexport function track(target, type, key) {\r\n    if (activeEffect === undefined) {\r\n        // 目前不需要收集依赖 没有effect\r\n        return;\r\n    }\r\n    let depsMap = targetMap.get(target);\r\n    if (!depsMap) {\r\n        targetMap.set(target, (depsMap = new Map()));\r\n    }\r\n    let dep = depsMap.get(key);\r\n    if (!dep) {\r\n        depsMap.set(key, (dep = new Set()));\r\n    }\r\n    trackEffects(dep);\r\n}\r\nexport function trackEffects(dep) {\r\n    dep.add(activeEffect);\r\n    activeEffect.deps.push(dep);\r\n    console.log(dep);\r\n}\r\nexport function trgger(target, type, key, newValue, oldValue) {\r\n    // 查看当前对象是否被收集过   也就是当前对象是否在effect中使用过\r\n    const depsMap = targetMap.get(target);\r\n    if (!depsMap)\r\n        return;\r\n    let deps = [];\r\n    if (key !== void 0) {\r\n        deps.push(depsMap.get(key));\r\n    }\r\n    switch (type) {\r\n        case 'add':\r\n            break;\r\n        case 'set':\r\n            // deps.push(depsMap.get(ITERATE_KEY))\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n    const effects = [];\r\n    for (const dep of deps) {\r\n        if (dep) {\r\n            effects.push(...dep);\r\n        }\r\n    }\r\n    triggerEffects(new Set(effects));\r\n}\r\nfunction triggerEffects(dep) {\r\n    for (const effect of dep) {\r\n        effect.run();\r\n    }\r\n}\r\n","import { hasOwn, isObject } from '@vue/shared';\r\nimport { track, trgger } from './effect';\r\nimport { isReadonly, reactive, readonly } from './reactive';\r\nconst get = createGetter();\r\nconst readonlyGet = createGetter(true);\r\nconst set = createSetter();\r\nfunction createGetter(isReadOnly = false, shallow = false) {\r\n    return function get(target, key) {\r\n        const res = Reflect.get(target, key);\r\n        isReadonly(res);\r\n        if (!isReadOnly) {\r\n            // 此处可以开始收集依赖\r\n            track(target, 'add', key);\r\n        }\r\n        // 如果是浅层代理  直接返回  不必考虑key是否为对象\r\n        if (shallow) {\r\n            return res;\r\n        }\r\n        if (isObject(res)) {\r\n            // 此处需要处理只读属性 不需要做深层代理\r\n            // 如果访问的是一个对象  才开始对该属性进行代理，此处避免初始化的时候进行深层代理问题   访问时候才开始代理 进行依赖收集\r\n            return isReadOnly ? readonly(res) : reactive(res);\r\n        }\r\n        return res;\r\n    };\r\n}\r\nfunction createSetter(isReadOnly = false, shallow = false) {\r\n    return function set(target, key, value) {\r\n        let oldValue = target[key];\r\n        // 判断 oldValue 是否为只读属性 只读属性不能修改  reactive({name: {name1: {name2: 2}}})   name1 有可能被readonly 包裹\r\n        isReadonly(oldValue);\r\n        // 判断是新增 还是修改\r\n        const hadKey = hasOwn(target, key);\r\n        const result = Reflect.set(target, key, value);\r\n        if (!hadKey) {\r\n            // 新增\r\n            trgger(target, 'add', key, value);\r\n        }\r\n        else {\r\n            // 修改\r\n            trgger(target, 'set', key, value, oldValue);\r\n        }\r\n        return result;\r\n    };\r\n}\r\nexport const mutableHandlers = {\r\n    get,\r\n    set\r\n};\r\nexport const readonlyHandlers = {\r\n    get: readonlyGet,\r\n    set(target, key) {\r\n        console.warn(`Set operation on key \"${String(key)}\" failed: target is readonly.`, target);\r\n        return true;\r\n    }\r\n};\r\n","import { isObject } from '@vue/shared';\r\nimport { mutableHandlers, readonlyHandlers } from './baseHandlers';\r\nexport const reactiveMap = new WeakMap();\r\nexport const shallowReactiveMap = new WeakMap();\r\nexport const readonlyMap = new WeakMap();\r\nexport const shallowReadonlyMap = new WeakMap();\r\nfunction createReactiveObject(target, isReadOnly, baseHandlers, proxyMap) {\r\n    if (!isObject(target)) {\r\n        console.warn(`value cannot be made reactive: ${String(target)}`);\r\n        return target;\r\n    }\r\n    const existingProxy = proxyMap.get(target);\r\n    if (existingProxy)\r\n        return target;\r\n    const proxy = new Proxy(target, baseHandlers);\r\n    proxyMap.set(target, proxy);\r\n    return proxy;\r\n}\r\nexport function reactive(target) {\r\n    // 先判断是否为isReadOnly\r\n    return createReactiveObject(target, false, mutableHandlers, reactiveMap);\r\n}\r\nexport function readonly(target) {\r\n    return createReactiveObject(target, true, readonlyHandlers, readonlyMap);\r\n}\r\nexport function isReadonly(value) {\r\n    return !!(value && value[\"__v_isReadonly\" /* ReactiveFlags.IS_READONLY */]);\r\n}\r\n","export * from './src';\r\nexport const hasChanged = (value, oldValue) => {\r\n    return !Object.is(value, oldValue);\r\n};\r\n","import { hasChanged, isObject } from '@mini-vue/shared';\r\nimport { reactive } from './reactive';\r\nexport function ref(value) {\r\n    return createRef(value);\r\n}\r\nfunction convert(value) {\r\n    return isObject(value) ? reactive(value) : value;\r\n}\r\nclass RefImpl {\r\n    constructor(value) {\r\n        this.dep = undefined;\r\n        this.__v_isRef = true;\r\n        this._value = convert(value);\r\n    }\r\n    get value() {\r\n        return this._value;\r\n    }\r\n    set value(newVal) {\r\n        if (hasChanged) {\r\n            this._value = convert(newVal);\r\n        }\r\n    }\r\n}\r\nexport function isRef(r) {\r\n    return !!(r && r.__v_isRef === true);\r\n}\r\nfunction createRef(rawValue) {\r\n    if (isRef(rawValue))\r\n        return rawValue;\r\n    return new RefImpl(rawValue);\r\n}\r\n"],"names":[],"mappings":"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"}